import { describe, expect, it } from "vitest";
import openapiTS from "../../dist/index.js";

describe("rawSchema", () => {
  it("v2", async () => {
    const v2schema = {
      User: {
        type: "object",
        properties: {
          name: { type: "string", description: "user name" },
          email: { type: "string", description: "user email" },
        },
        required: ["name", "email"],
      },
    };

    const output = await openapiTS(v2schema, { rawSchema: true, version: 2 });
    expect(output).to.equal(`/**
 * This file was auto-generated by openapi-typescript.
 * Do not make direct changes to the file.
 */
export interface paths {
  '/api/user/{id}': {
    parameters: {
      id: string;
    }
  }
}

export interface definitions {
  User: {
    /** @description user name */
    name: string;
    /** @description user email */
    email: string;
  };
}

export interface external {}
`);
  });

  it("v3", async () => {
    const v3schema = {
      User: {
        type: "object",
        properties: {
          name: { type: "string", description: "user name" },
          email: { type: "string", description: "user email" },
        },
        additionalProperties: false,
        required: ["name", "email"],
      },
    };

    const output = await openapiTS(v3schema, { rawSchema: true, version: 3 });
    expect(output).to.equal(`/**
 * This file was auto-generated by openapi-typescript.
 * Do not make direct changes to the file.
 */
export interface paths {
  '/api/user/{id}': {
    parameters: {
      id: string;
    }
  }
}

export interface schemas {
  User: {
    /** @description user name */
    name: string;
    /** @description user email */
    email: string;
  };
}

export interface external {}
`);
  });
});
